(()=>{"use strict";function e(e){"Escape"===e.key&&document.querySelector(".popup_is-opened").classList.remove("popup_is-opened")}function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}var o=document.querySelector("#card-template").content;function r(e,t,n,r,c){var a=o.querySelector(".card").cloneNode(!0);a.querySelector(".card__title").textContent=e.name;var u=a.querySelector(".card__image");u.src=e.link,u.alt="На картинке изображено место под названием "+e.name,a.querySelector(".card__like-counter").textContent=e.likes.length;var i=a.querySelector(".card__delete-button");return c||(i.style.display="none"),a.querySelector(".card__delete-button").addEventListener("click",t),a.querySelector(".card__like-button").addEventListener("click",n),u.addEventListener("click",r),a}function c(e){e.target.closest(".card").remove()}function a(e){e.target.closest(".card__like-button").classList.toggle("card__like-button_is-active")}var u=document.querySelector(".popup_type_image"),i=u.querySelector(".popup__image"),s=u.querySelector(".popup__caption");function l(e){i.src=e.target.src,i.alt=e.target.alt,s.textContent=e.target.alt.slice(43),t(u)}var p=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("".concat(n.inactiveButtonClass)):t.classList.add("".concat(n.inactiveButtonClass))},d=function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll("".concat(t.inputElement))),o=e.querySelector("".concat(t.submitButtonSelector));p(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove("".concat(n.inputErrorClass)),o.classList.remove("".concat(n.errorClass)),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add("".concat(o.inputErrorClass)),r.textContent=n,r.classList.add("".concat(o.errorClass))}(e,t,t.validationMessage,n)}(e,r,t),p(n,o,t)}))}))}(t,e)}))},_={baseUrl:"https://nomoreparties.co/v1/wff-cohort-18",headers:{authorization:"b5b1b6e6-dc47-4f9d-9970-65fb7065b8ad","Content-Type":"application/json"}},m=function(){return fetch("".concat(_.baseUrl,"/users/me"),{headers:_.headers}).then((function(e){if(e.ok)return e.json()}))},f=document.querySelector(".profile__add-button"),v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__image"),S=document.querySelectorAll(".popup"),h=document.querySelectorAll(".popup__close"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_edit_avatar"),E=document.querySelector(".places__list");f.addEventListener("click",(function(e){t(b)})),v.addEventListener("click",(function(e){t(q)})),y.addEventListener("click",(function(e){t(k)})),h.forEach((function(e){e.addEventListener("click",(function(e){n(e.target.closest(".popup"))}))})),S.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&n(e)}))}));var g=q.querySelector("form[name=edit-profile]"),C=g.querySelector(".popup__input_type_name"),L=g.querySelector(".popup__input_type_description");m().then((function(e){C.value=e.name,L.value=e.about})),q.querySelector(".popup__close").addEventListener("click",(function(){g.reset(),m().then((function(e){C.value=e.name,L.value=e.about}))}));var x=document.querySelector(".profile__title"),j=document.querySelector(".profile__description");m().then((function(e){x.textContent=e.name,j.textContent=e.about})),g.addEventListener("submit",(function(e){e.preventDefault();var t=C.value,o=L.value;x.textContent=t,j.textContent=o,C.value=x.textContent,L.value=j.textContent,function(e,t){fetch("".concat(_.baseUrl,"/users/me"),{method:"PATCH",headers:_.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(C.value,L.value),n(e.target.closest(".popup"))}));var A=document.querySelector("form[name=new-place]"),P=A.querySelector(".popup__input_type_card-name"),B=A.querySelector(".popup__input_type_url");A.addEventListener("submit",(function(e){var t,o;e.preventDefault(),E.prepend(r({name:P.value,link:B.value},c,a,l)),t=P.value,o=B.value,fetch("".concat(_.baseUrl,"/cards"),{method:"POST",headers:_.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),A.reset(),d({formSelector:".popup__form",inputElement:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}),n(e.target.closest(".popup"))}));var w=k.querySelector("form[name=edit-profile-avatar]"),U=w.querySelector(".popup__input_type_avatar-url"),D=document.querySelector(".profile__image");m().then((function(e){D.style.backgroundImage="url('".concat(e.avatar,"')")})),w.addEventListener("submit",(function(e){e.preventDefault(),D.style.backgroundImage="url('".concat(U.value,"')"),function(e){fetch("".concat(_.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:_.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(U.value),console.log(U.value),w.reset(),n(e.target.closest(".popup"))}));var N=[m(),fetch("".concat(_.baseUrl,"/cards"),{headers:_.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))];Promise.all(N).then((function(e){e[1].forEach((function(t){e[0]._id===t.owner._id?E.append(r({name:t.name,link:t.link,likes:t.likes},c,a,l,!0)):E.append(r({name:t.name,link:t.link,likes:t.likes},c,a,l,!1))}))})),d({formSelector:".popup__form",inputElement:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"})})();