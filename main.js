(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-18",headers:{authorization:"b5b1b6e6-dc47-4f9d-9970-65fb7065b8ad","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)},r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)},o=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)},c=document.querySelector("#card-template").content;function a(e,t,n,r,o){var a=c.querySelector(".card").cloneNode(!0);a.id=e.id,a.querySelector(".card__title").textContent=e.name;var u=a.querySelector(".card__image");u.src=e.link,u.alt="На картинке изображено место под названием "+e.name,a.querySelector(".card__like-counter").textContent=e.likes.length;var l=a.querySelector(".card__delete-button");e.owner.id!==o?l.style.display="none":l.addEventListener("click",r);var s=a.querySelector(".card__like-button");return e.likes.forEach((function(e){e._id===o&&s.classList.add("card__like-button_is-active")})),s.addEventListener("click",i),u.addEventListener("click",n),a}function i(e){(e.target.classList.contains("card__like-button_is-active")?o:r)(e.target.closest(".card").id).then((function(t){e.target.nextElementSibling.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}function u(e){"Escape"===e.key&&document.querySelector(".popup_is-opened").classList.remove("popup_is-opened")}function l(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}var d=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},p=function(e,t){e.classList.add(t),e.setAttribute("disabled",!0)},f=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):p(t,n.inactiveButtonClass)},_=function(e,t){var n=Array.from(e.querySelectorAll("".concat(t.inputElement))),r=e.querySelector("".concat(t.submitButtonSelector));p(r,t.inactiveButtonClass),n.forEach((function(n){d(e,n,t)}))},m=document.querySelector(".profile__add-button"),v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__image"),h=document.querySelectorAll(".popup"),S=document.querySelectorAll(".popup__close"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_edit_avatar"),g=document.querySelector(".places__list"),k=document.querySelector(".popup_type_image"),C=k.querySelector(".popup__image"),L=k.querySelector(".popup__caption"),x=document.querySelector(".popup_type_confirm_delete"),A={formSelector:".popup__form",inputElement:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function U(e){C.src=e.target.src,C.alt=e.target.alt,L.textContent=e.target.alt.slice(43),l(k)}function w(e){l(x);var t=e;x.querySelector(".popup__button").onclick=function(){(function(e){n(e.target.closest(".card").id),e.target.closest(".card").remove()})(t),s(x)}}function B(e){s(e.target.closest(".popup")),e.target.querySelector(".popup__button").textContent="Сохранить"}var T=function(e){e.target.querySelector(".popup__button").textContent="Сохранение..."},D=[fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)];Promise.all(D).then((function(e){e[1].forEach((function(t){g.append(a({name:t.name,link:t.link,likes:t.likes,id:t._id,owner:{id:t.owner._id}},0,U,w,e[0]._id))})),N.value=e[0].name,O.value=e[0].about,j.textContent=e[0].name,J.textContent=e[0].about,F.style.backgroundImage="url('".concat(e[0].avatar,"')")})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),r=e.querySelector(t.submitButtonSelector);f(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add("".concat(r.inputErrorClass)),o.textContent=n,o.classList.add("".concat(r.errorClass))}(e,t,t.validationMessage,n)}(e,o,t),f(n,r,t)}))}))}(t,e)}))}(A),m.addEventListener("click",(function(e){l(b)})),v.addEventListener("click",(function(e){l(q),_(q,A)})),y.addEventListener("click",(function(e){l(E)})),S.forEach((function(e){e.addEventListener("click",(function(e){s(e.target.closest(".popup"))}))})),h.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&s(e)}))}));var P=q.querySelector("form[name=edit-profile]"),N=P.querySelector(".popup__input_type_name"),O=P.querySelector(".popup__input_type_description");q.querySelector(".popup__close").addEventListener("click",(function(){P.reset(),N.value=j.textContent,O.value=J.textContent}));var j=document.querySelector(".profile__title"),J=document.querySelector(".profile__description");P.addEventListener("submit",(function(n){n.preventDefault();var r=N.value,o=O.value;T(n),function(n,r){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then(t)}(r,o).then((function(e){j.textContent=e.name,J.textContent=e.about,N.value=j.textContent,O.value=J.textContent})).finally((function(){B(n)}))}));var M=document.querySelector("form[name=new-place]"),H=M.querySelector(".popup__input_type_card-name"),I=M.querySelector(".popup__input_type_url");M.addEventListener("submit",(function(n){var r,o;n.preventDefault(),T(n),(r=H.value,o=I.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:o})}).then(t)).then((function(e){g.prepend(a(e,0,U,w,e.owner.id))})).finally((function(){B(n)})),M.reset(),_(M,A)}));var V=E.querySelector("form[name=edit-profile-avatar]"),z=V.querySelector(".popup__input_type_avatar-url"),F=document.querySelector(".profile__image");V.addEventListener("submit",(function(n){n.preventDefault(),T(n),function(n){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(t)}(z.value).then((function(e){F.style.backgroundImage="url('".concat(e.avatar,"')")})).finally((function(){B(n)})),V.reset()}))})();